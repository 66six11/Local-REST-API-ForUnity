/// <summary>
/// {{CONTROLLER_FULL_NAME}}.{{METHOD_NAME}} 方法的参数解析器（统一调用共享解析器）
/// 说明：
/// - 优先从 QueryString 取参数，其次在 POST/PUT/PATCH 时从 JSON/Form Body 取参数。
/// - 实际解析委托给 LocalRestAPI.ApiParameterParser（基于 Newtonsoft.Json），避免重复实现与正则问题。
/// - 通过反射读取 {{CONTROLLER_FULL_NAME}}.{{METHOD_NAME}} 的参数签名，避免模板展开错误。
/// </summary>
public class {{PARAMETER_PARSER_CLASS_NAME}} : IApiParameterParser
{
    public object[] ParseParameters(HttpListenerRequest request)
    {
        var controllerType = System.Type.GetType("{{CONTROLLER_FULL_NAME}}");
        if (controllerType == null)
            throw new System.Exception($"Parameter parser: 未找到控制器类型 {{CONTROLLER_FULL_NAME}}");

        var method = controllerType.GetMethod("{{METHOD_NAME}}", System.Reflection.BindingFlags.Public | System.Reflection.BindingFlags.Instance);
        if (method == null)
            throw new System.Exception($"Parameter parser: 在 {{CONTROLLER_FULL_NAME}} 未找到方法 {{METHOD_NAME}}");

        var paramInfos = method.GetParameters();
        var paramTypes = new System.Type[paramInfos.Length];
        var paramNames = new string[paramInfos.Length];
        object[] paramDefaults = paramInfos.Length > 0 ? new object[paramInfos.Length] : null;

        for (int i = 0; i < paramInfos.Length; i++)
        {
            var p = paramInfos[i];
            paramTypes[i] = p.ParameterType;
            paramNames[i] = p.Name;
            if (paramDefaults != null)
                paramDefaults[i] = p.HasDefaultValue ? p.DefaultValue : null;
        }

        return LocalRestAPI.ApiParameterParser.ParseParameters(
            request,
            paramTypes,
            paramNames,
            paramDefaults
        );
    }
}